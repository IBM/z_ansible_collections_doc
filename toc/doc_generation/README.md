<!-- Breadcrumbs -->
[Home](../README.md) â–¸ [Generating documentation](README.md)

## Documentation for Red Hat Certified Content for IBM Z

This repository provides the tooling necessary to extract, generate and
publish for the Ansible for IBM Z collections. The tooling will gather
documentation from all collections to unite the content under one offering.

# Instructions



After all requirements are installed, you can run the playbook in the order
listed below. Should some changes occure, do not check in **.gitmodules**,
any **HTHML** or **submodules**. The repository should be only contain
static content, the playbooks will pull the updated collections documentation,
submodules and build content each time dynamically.

Of the following playbooks listed below,  `site-uploader.yml` is optional. This
playbook will upload generated HTML to webserver for hosting when its easier to
share a link instead of creating an archive. This playbook must be run on the
same domain the webserver is hosted and you must know the encryption password
to access the webserver. The remaining playbooks can be run without any
limitations other than if you want to deploy the generated doc, you must have
write access to the repository.

## 1.0 Clone the repository
If you have not already done so, clone the repository. This assumes you have a
GitHub id. When you clone th repository, it will create a directory
named `z_ansible_collections_doc`, this is a good time to decide where you want
managed your cloned repositories, for example you might want to have this
directory structure `~/gh/` which will yield `~/gh/z_ansible_collections_doc`.

Clone the repository with the command:
```
git clone https://github.com/IBM/z_ansible_collections_doc.git
```

## 2.0 Update the registry
In order for the tooling to load the correct version of a collections documentation
you must update the `registry.yml`. Each collection maintains their own documentation
and release cadence, so there is no alignment between releases for the various collections.

This is what the `registry.yml` manages, it allows you to specify the collections versions
you want to include in the next documentation build. For example, if you were only updating
the `ibm_zos_core` collection so that it would include doc from
[GitHub tag](https://github.com/ansible-collections/ibm_zos_core/tags) `v1.13.1`, then you
update `registry.yml` to look like:

```
  ibm_zos_core:
    git: https://github.com/ansible-collections/ibm_zos_core.git
    stable:
    latest: v1.13.1
    origin: main
```

Optionally, if you wanted to consume documentation that was not tagged and in a
feature branch, you can enter the branch name as well, like so:

```
  ibm_zos_ims:
    git:  https://github.com/ansible-collections/ibm_zos_ims.git
    stable:
    latest: docs-update-known-issue-release-v1.3.0
    origin: main
```

You don't have to check in the `registry.yml`, its often updated with different versions
therefore not needing to maintain the last entry. 

## 3.0 The Ansible playbooks
Once the registry is updated, you are ready to run the Ansible playbooks that will generate
and publish the documentation. To publish documentation, you need write access to this repository
and must have [shared your SSH key with Git Hub](https://docs.github.com/en/authentication/connecting-to-github-with-ssh/adding-a-new-ssh-key-to-your-github-account#about-addition-of-ssh-keys-to-your-account) else the playbook that publishes the content will
fail. 

There are four playbooks, each with their respective descriptions.


1. `ansible-playbook -i inventory site-builder.yml`
   1. This will checkout the latest code from every collection included in
      the `registry.yml`. It will extract and generate HTML documentation,
      then display it in your local browser.
      , and if configured and permitted
      will commit and push the change to Git so it is live. By default, it
      does not push to Git and it requires permissions.
2. `ansible-playbook -i inventory site-deploy.yml`
    1. If your user has write access to the repository, this playbook will
       add, commit and push the changes to branch gh-pages. This playbook
       will allow you to publish documentation so its live.
3. `ansible-playbook -i inventory site-uploader.yml --ask-vault-pass`
    1. Is an **optional** playbook that when the password is provided, will
       upload the documentation generated by the `site-builder.yml` playbook
       to a webserver on the internal private network. The main purpose to
       use this playbook is if you want to share a link with others to review
       documentation before making it publicly available. You an always archive
       the **html** folder under directory `build/html` and share that as well.
4. `ansible-playbook -i inventory site-teardown.yml`
    1. This playbook will restore your local branch back to how it was after
       it was cloned. It will clean up any generated doc, submodules that were
       checked out, etc ensuring your environment is clean and ready for future
       execution.

## 4.0 Run the Ansible playbooks
It is important to always run the `ansible-playbook -i inventory site-teardown.yml`
when you are done generating or publishing documentation, it will ensure a clean
workspace and avoid any undesirable content from being checked in. 

Run the playbooks in this order to build, view and publish documentation.
1. `ansible-playbook -i inventory site-builder.yml` - this will build and display the generated HTML.
2. `ansible-playbook -i inventory site-deploy.yml` - this will check in the latest generated documentation and check it in.
3. `ansible-playbook -i inventory site-teardown.yml` - to clean up the work space.

Optionally, if you want to host the documentation you build without publishing it
to Git Hub for internal review, you can run the playbooks in this order. 
1. `ansible-playbook -i inventory site-builder.yml` - this will build and display the generated HTML.
2. `ansible-playbook -i inventory site-uploader.yml --ask-vault-pass` - this will publish to an internal web server, requires password. 
3. `ansible-playbook -i inventory site-teardown.yml` - to clean up the work space.
